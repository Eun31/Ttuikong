<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ttuikong.spring.model.dao.BoardDao">

	<!-- 전체 게시글 조회 -->
	<select id="selectAll" resultType="Board">
		SELECT b.id as postId,
		b.user_id, b.title, b.content, b.category,
		b.created_at, b.updated_at, b.image_url,
		u.nickname as user_nickname
		FROM board b
		LEFT JOIN user u ON b.user_id = u.id
		ORDER BY b.created_at DESC
	</select>

	<!-- 상세 게시글 조회 -->
	<select id="selectById" resultType="Board" parameterType="int">
		SELECT
		b.id as postId, b.user_id, b.title, b.content, b.category,
		b.created_at, b.updated_at, b.image_url,
		u.nickname as user_nickname
		FROM board b
		LEFT JOIN user u ON b.user_id = u.id
		WHERE b.id = #{postId}
	</select>

	<!-- 게시글 등록 -->
	<insert id="insertBoard" parameterType="Board"
		keyProperty="postId" useGeneratedKeys="true">
		INSERT INTO Board (user_id,
		title, content, category, image_url)
		VALUES (#{userId}, #{title},
		#{content}, #{category}, #{imageUrl});
	</insert>

	<!-- 게시글 삭제 -->
	<delete id="deleteBoard" parameterType="int">
		DELETE FROM Board
		WHERE id
		= #{postId};
	</delete>

	<!-- 게시글 수정 -->
	<update id="updateBoard" parameterType="Board">
		UPDATE Board
		SET title = #{title},
		content = #{content},
		category = #{category},
		image_url = #{imageUrl},
		updated_at = now()
		WHERE id = #{postId}
	</update>

	<!-- 사용자별 게시글 조회 -->
	<select id="selectByUserId" parameterType="int"
		resultType="Board">
		SELECT * FROM Board WHERE user_id = #{userId} ORDER BY
		created_at DESC
	</select>

	<!-- 카테고리별 게시글 조회 -->
	<select id="selectByCategory" parameterType="string"
		resultType="Board">
		SELECT * FROM Board WHERE category = #{category} ORDER BY
		created_at DESC
	</select>

</mapper>